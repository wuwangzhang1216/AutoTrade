# waxis-AutoTrade ç³»ç»Ÿæ¶æ„ V2ï¼ˆé‡æ„åï¼‰

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2024-11-07
**é‡æ„æ—¥æœŸ**: 2024-11-07
**å…³é”®æ”¹è¿›**: EventDetector ç»Ÿä¸€ä½¿ç”¨ TechnicalAnalyzer æŠ€æœ¯æŒ‡æ ‡ä½“ç³»

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](#ä¸€ç³»ç»Ÿæ¶æ„æ€»è§ˆ)
2. [æ ¸å¿ƒæ¨¡å—è¯¦ç»†æ¶æ„](#äºŒæ ¸å¿ƒæ¨¡å—è¯¦ç»†æ¶æ„)
   - [æŠ€æœ¯æŒ‡æ ‡å±‚ï¼ˆç»Ÿä¸€åï¼‰](#1-æŠ€æœ¯æŒ‡æ ‡å±‚ç»Ÿä¸€å)
   - [AI å†³ç­–ç³»ç»Ÿæ¶æ„](#2-ai-å†³ç­–ç³»ç»Ÿæ¶æ„)
   - [äº‹ä»¶ç›‘æ§ç³»ç»Ÿæ¶æ„ï¼ˆé‡æ„åï¼‰](#3-äº‹ä»¶ç›‘æ§ç³»ç»Ÿæ¶æ„é‡æ„å)
   - [æ•°æ®æµå‘](#4-æ•°æ®æµå‘)
3. [å½“å‰æ¶æ„çš„ä¼˜åŠ¿ä¸ä¸è¶³](#ä¸‰å½“å‰æ¶æ„çš„ä¼˜åŠ¿ä¸ä¸è¶³)
4. [å…³é”®ä¼˜åŒ–æœºä¼šåˆ†æ](#å››å…³é”®ä¼˜åŒ–æœºä¼šåˆ†æ)
5. [å»ºè®®çš„ä¼˜åŒ–è·¯å¾„](#äº”å»ºè®®çš„ä¼˜åŒ–è·¯å¾„)

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          waxis-AutoTrade ç³»ç»Ÿ                                â”‚
â”‚                      åŠ å¯†è´§å¸è‡ªåŠ¨äº¤æ˜“ AI ç³»ç»Ÿ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  å‰ç«¯ React  â”‚
                              â”‚  Dashboard   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ WebSocket + REST API
                              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   FastAPI    â”‚
                              â”‚   Backend    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´é©±åŠ¨å¾ªç¯   â”‚          â”‚  äº‹ä»¶é©±åŠ¨å¾ªç¯    â”‚         â”‚   æ•°æ®æ”¶é›†å±‚    â”‚
â”‚  (5åˆ†é’Ÿä¸€æ¬¡)   â”‚          â”‚  (5ç§’ä¸€æ¬¡)      â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                            â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ ¸å¿ƒæœåŠ¡å±‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚TechnicalAnalyzerâ”‚ â”‚FundamentalAnalyzerâ”‚ â”‚MarketDataCollectorâ”‚          â”‚
â”‚  â”‚   (ç»Ÿä¸€æŒ‡æ ‡æº) â”‚  â”‚              â”‚  â”‚    (CCXT)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AIDecisionSchedulerâ”‚       â”‚  EventMonitor   â”‚         â”‚ TradingEngine   â”‚
â”‚  â”œâ”€ analyze_symbol â”‚       â”‚  â”œâ”€ EventDetectorâ”‚        â”‚  â”œâ”€ Positions  â”‚
â”‚  â”œâ”€ make_ai_decisionâ”‚      â”‚  â”œâ”€ 6ç§äº‹ä»¶æ£€æµ‹ â”‚        â”‚  â”œâ”€ Capital    â”‚
â”‚  â””â”€ execute_trade  â”‚       â”‚  â””â”€ WebSocketæ¨é€â”‚        â”‚  â””â”€ PnLè®¡ç®—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Database   â”‚
                              â”‚  PostgreSQL  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒäº¤æ˜“å¯¹

æ ¹æ®ç³»ç»Ÿä¼˜åŒ–ï¼Œå½“å‰ç›‘æ§ **3 ä¸ªæ ¸å¿ƒäº¤æ˜“å¯¹**ï¼š
- **BTC/USDT** - æ¯”ç‰¹å¸
- **ETH/USDT** - ä»¥å¤ªåŠ
- **SOL/USDT** - Solana

### å…³é”®é…ç½®

| å‚æ•° | é…ç½®å€¼ | è¯´æ˜ |
|-----|--------|------|
| AI å†³ç­–å‘¨æœŸ | 5 åˆ†é’Ÿ | AIDecisionScheduler è¿è¡Œé—´éš” |
| äº‹ä»¶æ£€æµ‹å‘¨æœŸ | 5 ç§’ | EventMonitor è¿è¡Œé—´éš” |
| AI æ¨¡å‹ | DeepSeek v3.1 + Qwen3 VL 235B | åŒæ¨¡å‹æŠ•ç¥¨ |
| æŠ•ç¥¨ç­–ç•¥ | Majority Vote | é»˜è®¤ç­–ç•¥ |
| ä¿¡å¿ƒåº¦é˜ˆå€¼ | 60% (åŒæ¨¡å‹) / 55% (å•æ¨¡å‹) | æœ€ä½æ‰§è¡Œé˜ˆå€¼ |
| æ æ†å€æ•° | å¯é…ç½® | é»˜è®¤ 10x |

---

## äºŒã€æ ¸å¿ƒæ¨¡å—è¯¦ç»†æ¶æ„

### 1. æŠ€æœ¯æŒ‡æ ‡å±‚ï¼ˆç»Ÿä¸€åï¼‰âœ¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TechnicalAnalyzer (å”¯ä¸€æŒ‡æ ‡æº)                   â”‚
â”‚                   backend/analysis/technical_indicators.py         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  calculate_all_indicators(df: DataFrame) -> DataFrame              â”‚
â”‚    â”œâ”€ è¶‹åŠ¿æŒ‡æ ‡                                                      â”‚
â”‚    â”‚   â€¢ MA (7, 25, 99 å‘¨æœŸ)                                       â”‚
â”‚    â”‚   â€¢ EMA (12, 26 å‘¨æœŸ)                                         â”‚
â”‚    â”‚   â€¢ MACD (12, 26, 9)                                          â”‚
â”‚    â”‚   â€¢ ADX (14) - è¶‹åŠ¿å¼ºåº¦                                       â”‚
â”‚    â”œâ”€ éœ‡è¡æŒ‡æ ‡                                                      â”‚
â”‚    â”‚   â€¢ RSI (14) - è¶…ä¹°è¶…å–                                       â”‚
â”‚    â”‚   â€¢ Stochastic (K%, D%) - éšæœºæŒ‡æ ‡                            â”‚
â”‚    â”œâ”€ æ³¢åŠ¨æŒ‡æ ‡                                                      â”‚
â”‚    â”‚   â€¢ Bollinger Bands (20, 2Ïƒ)                                 â”‚
â”‚    â”‚   â€¢ ATR (14) - å¹³å‡çœŸå®æ³¢å¹…                                   â”‚
â”‚    â””â”€ æˆäº¤é‡/åŠ¨é‡æŒ‡æ ‡                                              â”‚
â”‚        â€¢ OBV - èƒ½é‡æ½®                                              â”‚
â”‚        â€¢ Momentum (10)                                            â”‚
â”‚                                                                    â”‚
â”‚  get_trend_signals(df) -> Dict[str, str]                          â”‚
â”‚    â””â”€ ç”Ÿæˆä¿¡å·: ma_cross, macd, rsi, bb, stoch, trend_strength   â”‚
â”‚                                                                    â”‚
â”‚  get_trading_summary(df, symbol) -> Dict                          â”‚
â”‚    â””â”€ ç»¼åˆå»ºè®®: STRONG_BUY, BUY, HOLD, SELL, STRONG_SELL         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²                    â–²
                            â”‚                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚ AIå†³ç­–ç³»ç»Ÿ  â”‚      â”‚ äº‹ä»¶ç›‘æ§ç³»ç»Ÿ â”‚
                    â”‚ (æ¯5åˆ†é’Ÿ)   â”‚      â”‚  (æ¯5ç§’)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æŒ‡æ ‡è¯¦ç»†è¯´æ˜

| æŒ‡æ ‡ç±»å‹ | æŒ‡æ ‡åç§° | å‚æ•° | ç”¨é€” |
|---------|---------|------|------|
| **è¶‹åŠ¿æŒ‡æ ‡** | MA | 7, 25, 99 | è¯†åˆ«çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸè¶‹åŠ¿ |
| | EMA | 12, 26 | å¿«é€Ÿå“åº”ä»·æ ¼å˜åŒ– |
| | MACD | 12, 26, 9 | é‡‘å‰/æ­»å‰ä¿¡å·ï¼Œè¶‹åŠ¿åè½¬ |
| | ADX | 14 | è¶‹åŠ¿å¼ºåº¦åˆ¤æ–­ (>25 å¼ºè¶‹åŠ¿) |
| **éœ‡è¡æŒ‡æ ‡** | RSI | 14 | è¶…ä¹°(>70)ã€è¶…å–(<30) |
| | Stochastic | K%, D% | åŠ¨é‡åˆ¤æ–­ï¼Œäº¤å‰ä¿¡å· |
| **æ³¢åŠ¨æŒ‡æ ‡** | Bollinger Bands | 20, 2Ïƒ | ä»·æ ¼è¾¹ç•Œï¼Œçªç ´ä¿¡å· |
| | ATR | 14 | æ³¢åŠ¨ç‡æµ‹é‡ï¼Œæ­¢æŸå‚è€ƒ |
| **æˆäº¤é‡æŒ‡æ ‡** | OBV | - | èµ„é‡‘æµå‘ï¼ŒèƒŒç¦»ä¿¡å· |
| **åŠ¨é‡æŒ‡æ ‡** | Momentum | 10 | ä»·æ ¼åŠ¨é‡å˜åŒ– |

#### ä¿¡å·ç”Ÿæˆé€»è¾‘

```python
get_trend_signals() è¿”å›ï¼š
{
    'ma_cross': 'golden_cross' | 'death_cross' | 'neutral',
    'macd': 'bullish' | 'bearish' | 'neutral',
    'rsi': 'overbought' | 'oversold' | 'neutral',
    'bb': 'upper_break' | 'lower_break' | 'neutral',
    'stoch': 'overbought' | 'oversold' | 'neutral',
    'trend_strength': 'strong' | 'weak' | 'neutral'
}
```

#### ç»¼åˆäº¤æ˜“å»ºè®®

```python
get_trading_summary() æµç¨‹ï¼š
1. ç»Ÿè®¡æ‰€æœ‰çœ‹æ¶¨ä¿¡å·æ•°é‡ (bullish_signals)
2. ç»Ÿè®¡æ‰€æœ‰çœ‹è·Œä¿¡å·æ•°é‡ (bearish_signals)
3. è®¡ç®—ä¿¡å·å·®å€¼ (signal_diff)
4. ç”Ÿæˆå»ºè®®ï¼š
   - signal_diff >= 4: STRONG_BUY
   - signal_diff >= 2: BUY
   - -1 <= signal_diff <= 1: HOLD
   - signal_diff <= -2: SELL
   - signal_diff <= -4: STRONG_SELL
```

#### ğŸ”¹ é‡æ„å…³é”®æ”¹è¿›

**æ”¹è¿›å‰**:
```python
# EventDetector æ‰‹åŠ¨å®ç° ATR è®¡ç®—
def _calculate_atr(self, klines, period):
    true_ranges = []
    for i in range(1, len(klines)):
        high = float(klines[i]['high'])
        low = float(klines[i]['low'])
        prev_close = float(klines[i - 1]['close'])
        tr = max(high - low, abs(high - prev_close), abs(low - prev_close))
        true_ranges.append(tr)
    atr = np.mean(true_ranges[-period:])
    return float(atr)
```

**æ”¹è¿›å**:
```python
# EventDetector ä½¿ç”¨ TechnicalAnalyzer
df = self._klines_to_dataframe(klines_1h)
df = self.technical_analyzer.calculate_all_indicators(df)
current_atr = df['ATR'].iloc[-1]  # ä½¿ç”¨ä¸“ä¸šåº“è®¡ç®—
```

**æ”¶ç›Š**:
- âœ… åˆ é™¤ 37 è¡Œé‡å¤ä»£ç 
- âœ… è®¡ç®—ç»“æœä¸€è‡´æ€§ä¿è¯
- âœ… æ˜“äºæ‰©å±•æ–°çš„æŒ‡æ ‡å‹äº‹ä»¶
- âœ… ç»´æŠ¤æˆæœ¬é™ä½

---

### 2. AI å†³ç­–ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AIDecisionScheduler                              â”‚
â”‚                   (æ¯ 5 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ - ç‹¬ç«‹çº¿ç¨‹)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  1. analyze_symbol(symbol) -> analysis                               â”‚
â”‚     â”œâ”€ è·å–å½“å‰ä»·æ ¼ (ticker)                                          â”‚
â”‚     â”œâ”€ è·å– OHLCV æ•°æ® (200æ ¹Kçº¿, 1hæ—¶é—´æ¡†æ¶)                        â”‚
â”‚     â”œâ”€ ğŸ”¹ è°ƒç”¨ TechnicalAnalyzer.calculate_all_indicators()          â”‚
â”‚     â”œâ”€ ğŸ”¹ è°ƒç”¨ TechnicalAnalyzer.get_trading_summary()               â”‚
â”‚     â”œâ”€ è·å–åŸºæœ¬é¢åˆ†æ (FundamentalAnalyzer)                          â”‚
â”‚     â””â”€ è·å–å¸‚åœºæƒ…ç»ª                                                  â”‚
â”‚                                                                       â”‚
â”‚  2. make_ai_decision(symbol, analysis) -> decision                   â”‚
â”‚     â”œâ”€ æ„å»ºè´¦æˆ·ä¸Šä¸‹æ–‡ (account_context)                              â”‚
â”‚     â”‚   â€¢ total_equity, capital, pnl, positions                     â”‚
â”‚     â”œâ”€ æ„å»ºæŒä»“ä¸Šä¸‹æ–‡ (position_context) â­                          â”‚
â”‚     â”‚   â€¢ side (LONG/SHORT)                                         â”‚
â”‚     â”‚   â€¢ entry_price, unrealized_pnl, liquidation_price            â”‚
â”‚     â”œâ”€ è°ƒç”¨ AIDecisionEngine.get_dual_model_decision()              â”‚
â”‚     â”‚   â”œâ”€ Model 1: DeepSeek Chat v3.1                             â”‚
â”‚     â”‚   â”œâ”€ Model 2: Qwen3 VL 235B                                   â”‚
â”‚     â”‚   â””â”€ æŠ•ç¥¨ç­–ç•¥: majority/unanimous/weighted                   â”‚
â”‚     â”œâ”€ è®°å½•å†³ç­–åˆ°æ•°æ®åº“                                              â”‚
â”‚     â””â”€ å¦‚æœä¿¡å¿ƒåº¦ >= 60% â†’ execute_trade()                          â”‚
â”‚                                                                       â”‚
â”‚  3. execute_trade(symbol, decision, price, ...) -> bool              â”‚
â”‚     â”œâ”€ BUY é€»è¾‘:                                                     â”‚
â”‚     â”‚   â€¢ æœ‰ SHORT æŒä»“ â†’ å…ˆå¹³ä»“ SHORT                               â”‚
â”‚     â”‚   â€¢ æ— æŒä»“æˆ–å·²å¹³ä»“ â†’ å¼€ä»“ LONG                                  â”‚
â”‚     â”œâ”€ SELL é€»è¾‘:                                                    â”‚
â”‚     â”‚   â€¢ æœ‰ LONG æŒä»“ â†’ å…ˆå¹³ä»“ LONG                                 â”‚
â”‚     â”‚   â€¢ æ— æŒä»“æˆ–å·²å¹³ä»“ â†’ å¼€ä»“ SHORT                                 â”‚
â”‚     â””â”€ è®°å½•äº¤æ˜“åˆ°æ•°æ®åº“                                              â”‚
â”‚                                                                       â”‚
â”‚  4. save_account_snapshot()                                          â”‚
â”‚     â””â”€ ä¿å­˜è´¦æˆ·å¿«ç…§ (ç”¨äºæƒç›Šæ›²çº¿)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AIDecisionEngineï¼ˆåŒæ¨¡å‹æŠ•ç¥¨ç³»ç»Ÿï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AIDecisionEngine                                â”‚
â”‚                      (åŒæ¨¡å‹æŠ•ç¥¨ç³»ç»Ÿ)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  get_dual_model_decision(symbol, price, technical, ...) ->           â”‚
â”‚      (model_1_decision, model_2_decision, final_decision)            â”‚
â”‚                                                                       â”‚
â”‚  å¹¶è¡Œæ‰§è¡Œ (ThreadPoolExecutor):                                       â”‚
â”‚    â”œâ”€ Model 1: get_single_model_decision(DeepSeek, ...)             â”‚
â”‚    â””â”€ Model 2: get_single_model_decision(Qwen3, ...)                â”‚
â”‚                                                                       â”‚
â”‚  æŠ•ç¥¨ç­–ç•¥:                                                            â”‚
â”‚    1. Majority Vote (é»˜è®¤):                                          â”‚
â”‚       â€¢ ä¸¤æ¨¡å‹ä¸€è‡´ + å¹³å‡ä¿¡å¿ƒ >= 60% â†’ æ‰§è¡Œ                          â”‚
â”‚       â€¢ ä¸¤æ¨¡å‹ä¸ä¸€è‡´ + ä¿¡å¿ƒå·® > 20% â†’ é‡‡ç”¨é«˜ä¿¡å¿ƒ                     â”‚
â”‚       â€¢ ä¸¤æ¨¡å‹ä¸ä¸€è‡´ + ä¿¡å¿ƒå·® <= 20% â†’ HOLD                          â”‚
â”‚                                                                       â”‚
â”‚    2. Unanimous Vote (ä¿å®ˆ):                                         â”‚
â”‚       â€¢ å¿…é¡»ä¸¤æ¨¡å‹å®Œå…¨ä¸€è‡´ + å¹³å‡ä¿¡å¿ƒ >= 60%                         â”‚
â”‚                                                                       â”‚
â”‚    3. Weighted Vote (åŠ æƒ):                                          â”‚
â”‚       â€¢ è®¡ç®—åŠ æƒåˆ†æ•° (weight Ã— confidence)                           â”‚
â”‚       â€¢ åˆ†æ•°å·® >= 15% + è·èƒœæ¨¡å‹ä¿¡å¿ƒ >= 60%                          â”‚
â”‚                                                                       â”‚
â”‚  should_execute_decision(decision, model_1, model_2) -> bool         â”‚
â”‚    â”œâ”€ HOLD â†’ æ°¸ä¸æ‰§è¡Œ                                                â”‚
â”‚    â”œâ”€ å•æ¨¡å‹å¯ç”¨ â†’ é˜ˆå€¼ 55%                                          â”‚
â”‚    â””â”€ åŒæ¨¡å‹å¯ç”¨ â†’ é˜ˆå€¼ 60%                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¸Šä¸‹æ–‡æ•°æ®ä¼ é€’

AI å†³ç­–æ—¶ä¼šæ¥æ”¶å®Œæ•´çš„å¸‚åœºå’Œè´¦æˆ·ä¸Šä¸‹æ–‡ï¼š

```python
{
    # å¸‚åœºæ•°æ®
    'symbol': 'BTC/USDT',
    'current_price': 67500.00,
    'technical_summary': {
        'recommendation': 'BUY',
        'signals': {...},
        'current_price': 67500.00,
        'indicators': {...}
    },
    'fundamental_analysis': {...},
    'market_sentiment': {...},

    # è´¦æˆ·ä¸Šä¸‹æ–‡
    'account_context': {
        'total_equity': 105000.00,
        'capital': 100000.00,
        'total_pnl': 5000.00,
        'total_pnl_percent': 5.0,
        'open_positions': 2,
        'max_positions': 3
    },

    # æŒä»“ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæœ‰ï¼‰
    'position_context': {
        'side': 'LONG',
        'entry_price': 66000.00,
        'unrealized_pnl': 1500.00,
        'pnl_percent': 2.27,
        'liquidation_price': 60000.00,
        'duration_minutes': 120
    }
}
```

---

### 3. äº‹ä»¶ç›‘æ§ç³»ç»Ÿæ¶æ„ï¼ˆé‡æ„åï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EventMonitor                                  â”‚
â”‚                    (æ¯ 5 ç§’è¿è¡Œä¸€æ¬¡ - ç‹¬ç«‹çº¿ç¨‹)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  _monitoring_loop():                                                  â”‚
â”‚    â””â”€ for each symbol:                                               â”‚
â”‚        â””â”€ _check_symbol(symbol)                                      â”‚
â”‚                                                                       â”‚
â”‚  _check_symbol(symbol):                                              â”‚
â”‚    â”œâ”€ 1. _fetch_market_data(symbol) -> market_data                  â”‚
â”‚    â”‚     â€¢ ticker (å½“å‰ä»·æ ¼, æˆäº¤é‡)                                 â”‚
â”‚    â”‚     â€¢ klines_1m (60æ ¹)                                          â”‚
â”‚    â”‚     â€¢ klines_5m (60æ ¹)                                          â”‚
â”‚    â”‚     â€¢ klines_15m (60æ ¹)                                         â”‚
â”‚    â”‚     â€¢ klines_1h (30æ ¹)                                          â”‚
â”‚    â”‚     â€¢ avg_volume_24h (è®¡ç®—å¹³å‡æˆäº¤é‡)                          â”‚
â”‚    â”‚                                                                  â”‚
â”‚    â”œâ”€ 2. è°ƒç”¨ EventDetector æ£€æµ‹å„ç±»äº‹ä»¶:                           â”‚
â”‚    â”‚     â€¢ detect_flash_move() - å¿«é€Ÿä¸‹è·Œ/ä¸Šæ¶¨                      â”‚
â”‚    â”‚     â€¢ detect_volume_spike() - æˆäº¤é‡æ¿€å¢                       â”‚
â”‚    â”‚     â€¢ detect_volume_dry() - æˆäº¤é‡æ¯ç«­                         â”‚
â”‚    â”‚     â€¢ detect_volatility_spike() - æ³¢åŠ¨ç‡æ¿€å¢ ğŸ”¹               â”‚
â”‚    â”‚     â€¢ detect_liquidation_risk() - æ¸…ç®—é£é™©                     â”‚
â”‚    â”‚                                                                  â”‚
â”‚    â””â”€ 3. å¤„ç†æ£€æµ‹åˆ°çš„äº‹ä»¶:                                          â”‚
â”‚        â””â”€ _handle_event(event)                                      â”‚
â”‚            â”œâ”€ æ›´æ–°ç»Ÿè®¡ä¿¡æ¯                                           â”‚
â”‚            â”œâ”€ è®°å½•åˆ°æ—¥å¿—                                             â”‚
â”‚            â”œâ”€ ä¿å­˜åˆ°æ•°æ®åº“                                           â”‚
â”‚            â””â”€ WebSocket å®æ—¶æ¨é€                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### EventDetectorï¼ˆé‡æ„åï¼‰ğŸ”¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EventDetector (é‡æ„å)                         â”‚
â”‚                   backend/events/event_detector.py                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  __init__():                                                          â”‚
â”‚    â”œâ”€ self.last_event_times: Dict[str, datetime] # å†·å´æœŸç®¡ç†       â”‚
â”‚    â””â”€ ğŸ”¹ self.technical_analyzer = TechnicalAnalyzer()               â”‚
â”‚        (ç»Ÿä¸€ä½¿ç”¨ç°æœ‰æŠ€æœ¯æŒ‡æ ‡ä½“ç³»)                                    â”‚
â”‚                                                                       â”‚
â”‚  æ£€æµ‹æ–¹æ³•:                                                            â”‚
â”‚                                                                       â”‚
â”‚  1. detect_flash_move(symbol, klines_1m, klines_5m, klines_15m)     â”‚
â”‚     â€¢ è®¡ç®— 1/5/15 åˆ†é’Ÿä»·æ ¼å˜åŒ–                                       â”‚
â”‚     â€¢ é˜ˆå€¼: >= 2% (è§¦å‘äº‹ä»¶)                                        â”‚
â”‚     â€¢ ä¸¥é‡ç¨‹åº¦: >5% CRITICAL, >3% HIGH, >2% MEDIUM                  â”‚
â”‚                                                                       â”‚
â”‚  2. detect_volume_spike(symbol, current_volume, avg_24h)            â”‚
â”‚     â€¢ è®¡ç®—æˆäº¤é‡æ¯”ç‡: current / avg_24h                             â”‚
â”‚     â€¢ é˜ˆå€¼: >= 2x (è§¦å‘äº‹ä»¶)                                        â”‚
â”‚     â€¢ ä¸¥é‡ç¨‹åº¦: >5x CRITICAL, >3x HIGH, >2x MEDIUM                  â”‚
â”‚                                                                       â”‚
â”‚  3. detect_volume_dry(symbol, current_volume, avg_24h)              â”‚
â”‚     â€¢ è®¡ç®—æˆäº¤é‡æ¯”ç‡: current / avg_24h                             â”‚
â”‚     â€¢ é˜ˆå€¼: <= 0.2x (è§¦å‘äº‹ä»¶)                                      â”‚
â”‚     â€¢ ä¸¥é‡ç¨‹åº¦: <0.1x CRITICAL, <0.15x HIGH, <0.2x MEDIUM           â”‚
â”‚                                                                       â”‚
â”‚  4. detect_volatility_spike(symbol, klines_1h) ğŸ”¹ é‡æ„              â”‚
â”‚     â”œâ”€ df = self._klines_to_dataframe(klines_1h)                    â”‚
â”‚     â”œâ”€ ğŸ”¹ df = self.technical_analyzer.calculate_all_indicators(df) â”‚
â”‚     â”œâ”€ current_atr = df['ATR'].iloc[-1]                             â”‚
â”‚     â”œâ”€ historical_atr = df['ATR'].iloc[-15]                         â”‚
â”‚     â”œâ”€ volatility_ratio = current_atr / historical_atr              â”‚
â”‚     â€¢ é˜ˆå€¼: >= 1.5x (è§¦å‘äº‹ä»¶)                                      â”‚
â”‚     â€¢ ä¸¥é‡ç¨‹åº¦: >3x CRITICAL, >2x HIGH, >1.5x MEDIUM                â”‚
â”‚                                                                       â”‚
â”‚  5. detect_liquidation_risk(symbol, position, current_price)        â”‚
â”‚     â€¢ è®¡ç®—è·ç¦»æ¸…ç®—ä»·æ ¼çš„ç™¾åˆ†æ¯”                                       â”‚
â”‚     â€¢ é˜ˆå€¼: <= 10% (è§¦å‘äº‹ä»¶)                                       â”‚
â”‚     â€¢ ä¸¥é‡ç¨‹åº¦: <2% CRITICAL, <5% HIGH, <10% MEDIUM                 â”‚
â”‚                                                                       â”‚
â”‚  è¾…åŠ©æ–¹æ³•:                                                            â”‚
â”‚    ğŸ”¹ _klines_to_dataframe(klines) -> DataFrame (æ–°å¢)               â”‚
â”‚       â””â”€ å°† Kçº¿åˆ—è¡¨è½¬æ¢ä¸º TechnicalAnalyzer éœ€è¦çš„æ ¼å¼              â”‚
â”‚    âŒ _calculate_atr() (å·²åˆ é™¤ - ä½¿ç”¨ TechnicalAnalyzer)             â”‚
â”‚    _calculate_price_change(klines, periods) -> float                â”‚
â”‚    _check_cooldown(symbol, event_type, current_time) -> bool        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº‹ä»¶ç±»å‹è¯¦ç»†è¯´æ˜

| äº‹ä»¶ç±»å‹ | EventType | æ£€æµ‹é€»è¾‘ | è§¦å‘é˜ˆå€¼ | å†·å´æœŸ |
|---------|-----------|---------|---------|--------|
| å¿«é€Ÿä¸‹è·Œ | FLASH_CRASH | 1/5/15åˆ†é’ŸKçº¿è·Œå¹… | >= 2% | 5 åˆ†é’Ÿ |
| å¿«é€Ÿä¸Šæ¶¨ | FLASH_RALLY | 1/5/15åˆ†é’ŸKçº¿æ¶¨å¹… | >= 2% | 5 åˆ†é’Ÿ |
| æˆäº¤é‡æ¿€å¢ | VOLUME_SPIKE | å½“å‰æˆäº¤é‡ / 24hå¹³å‡ | >= 2x | 5 åˆ†é’Ÿ |
| æˆäº¤é‡æ¯ç«­ | VOLUME_DRY | å½“å‰æˆäº¤é‡ / 24hå¹³å‡ | <= 0.2x | 10 åˆ†é’Ÿ |
| æ³¢åŠ¨ç‡æ¿€å¢ | VOLATILITY_SPIKE | ATR æ¯”ç‡ | >= 1.5x | 5 åˆ†é’Ÿ |
| æ¸…ç®—é£é™© | LIQUIDATION_RISK | è·ç¦»æ¸…ç®—ä»·ç™¾åˆ†æ¯” | <= 10% | 2 åˆ†é’Ÿ |

#### ä¸¥é‡ç¨‹åº¦åˆ¤å®š

```python
EventSeverity ç­‰çº§ï¼š
- CRITICAL: éœ€è¦ç«‹å³å…³æ³¨ï¼ˆä¾‹å¦‚ï¼š>5%è·Œå¹…ã€è·ç¦»æ¸…ç®—<2%ï¼‰
- HIGH: é«˜åº¦è­¦æƒ•ï¼ˆä¾‹å¦‚ï¼š3-5%è·Œå¹…ã€è·ç¦»æ¸…ç®—2-5%ï¼‰
- MEDIUM: ä¸­ç­‰å…³æ³¨ï¼ˆä¾‹å¦‚ï¼š2-3%è·Œå¹…ã€è·ç¦»æ¸…ç®—5-10%ï¼‰
- LOW: ä½ä¼˜å…ˆçº§
```

---

### 4. æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CCXT API   â”‚ (äº¤æ˜“æ‰€æ•°æ®æº)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MarketDataCollectorâ”‚
â”‚  â€¢ get_ticker()    â”‚
â”‚  â€¢ get_ohlcv()     â”‚
â”‚  â€¢ get_price()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Main   â”‚   â”‚  AIå†³ç­– â”‚   â”‚  äº‹ä»¶ç›‘æ§ â”‚
    â”‚  Loop   â”‚   â”‚ è°ƒåº¦å™¨  â”‚   â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚TechnicalAnalyzerâ”‚ ğŸ”¹ ç»Ÿä¸€æŒ‡æ ‡æº
              â”‚  â€¢ ATR         â”‚
              â”‚  â€¢ RSI         â”‚
              â”‚  â€¢ MACD        â”‚
              â”‚  â€¢ ...         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼             â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚AIå†³ç­–å¼•æ“â”‚  â”‚äº‹ä»¶æ£€æµ‹å™¨â”‚  â”‚å‰ç«¯å±•ç¤º  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ TradingEngine â”‚
       â”‚  â€¢ open_long  â”‚
       â”‚  â€¢ open_short â”‚
       â”‚  â€¢ close      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Database    â”‚
       â”‚  â€¢ trades     â”‚
       â”‚  â€¢ decisions  â”‚
       â”‚  â€¢ events     â”‚
       â”‚  â€¢ snapshots  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®åº“è¡¨ç»“æ„

**æ ¸å¿ƒæ•°æ®è¡¨**ï¼š

1. **trades** - äº¤æ˜“è®°å½•
   - symbol, order_type, side, amount, price, fee, pnl, margin, leverage, timestamp

2. **ai_decisions** - AI å†³ç­–è®°å½•
   - symbol, model_1_decision, model_2_decision, final_decision, confidence, executed, timestamp

3. **market_events** - å¸‚åœºäº‹ä»¶è®°å½•
   - symbol, event_type, severity, description, suggested_action, metrics, processed, timestamp

4. **account_snapshots** - è´¦æˆ·å¿«ç…§ï¼ˆæƒç›Šæ›²çº¿ï¼‰
   - total_equity, capital, unrealized_pnl, open_positions, timestamp

---

## ä¸‰ã€å½“å‰æ¶æ„çš„ä¼˜åŠ¿ä¸ä¸è¶³

### âœ… æ¶æ„ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ | å½±å“ |
|-----|------|------|
| **ç»Ÿä¸€æŠ€æœ¯æŒ‡æ ‡ä½“ç³»** | æ‰€æœ‰æ¨¡å—å…±äº« `TechnicalAnalyzer` | è®¡ç®—ä¸€è‡´æ€§ä¿è¯ |
| **åŒçº¿ç¨‹å¹¶è¡Œè¿è¡Œ** | AIå†³ç­–(5åˆ†é’Ÿ) + äº‹ä»¶ç›‘æ§(5ç§’) ç‹¬ç«‹è¿è¡Œ | äº’ä¸é˜»å¡ï¼Œå“åº”å¿«é€Ÿ |
| **åŒæ¨¡å‹æŠ•ç¥¨ç³»ç»Ÿ** | DeepSeek + Qwen3 äº¤å‰éªŒè¯ | é™ä½å•æ¨¡å‹é”™è¯¯ç‡ |
| **ä½ç½®æ„ŸçŸ¥å†³ç­–** | AI æ¥æ”¶æŒä»“ä¸Šä¸‹æ–‡ï¼ŒçŸ¥é“å½“å‰æŒä»“çŠ¶æ€ | æ›´æ™ºèƒ½çš„å¼€å¹³ä»“å†³ç­– |
| **äº‹ä»¶å®æ—¶æ¨é€** | WebSocket å¹¿æ’­å¸‚åœºå¼‚å¸¸ | ç”¨æˆ·å³æ—¶æ„ŸçŸ¥é£é™© |
| **å®Œæ•´æ•°æ®è®°å½•** | æ‰€æœ‰å†³ç­–ã€äº¤æ˜“ã€äº‹ä»¶å…¥åº“ | å¯è¿½æº¯ã€å¯å›æµ‹ |

### âš ï¸ æ½œåœ¨ä¼˜åŒ–ç©ºé—´

| é—®é¢˜ç‚¹ | å½“å‰çŠ¶æ€ | å½±å“ç¨‹åº¦ | ä¼˜åŒ–å»ºè®® |
|-------|---------|---------|---------|
| **ğŸ”´ AI ä¸äº‹ä»¶ç³»ç»Ÿå­¤ç«‹** | AI å†³ç­–æ—¶ä¸æ„ŸçŸ¥æ£€æµ‹åˆ°çš„å¸‚åœºäº‹ä»¶ | **é«˜** | AI-äº‹ä»¶è”åŠ¨ |
| **ğŸŸ¡ é‡å¤æ•°æ®è·å–** | AI å’Œäº‹ä»¶ç›‘æ§å„è‡ªè·å–å¸‚åœºæ•°æ® | ä¸­ | å…±äº«æ•°æ®ç¼“å­˜ |
| **ğŸŸ¡ å•ä¸€æ—¶é—´æ¡†æ¶** | AI åªä½¿ç”¨ 1h æ—¶é—´æ¡†æ¶åˆ†æ | ä¸­ | å¤šæ—¶é—´æ¡†æ¶åˆ†æ |
| **ğŸŸ¡ äº‹ä»¶æ£€æµ‹èƒ½åŠ›æœ‰é™** | ä»… 6 ç§äº‹ä»¶ç±»å‹ | ä¸­ | å¢åŠ æŒ‡æ ‡å‹äº‹ä»¶ |
| **ğŸŸ¢ å†·å´æœŸæœºåˆ¶å•ä¸€** | å›ºå®šå†·å´æ—¶é—´ | ä½ | åŠ¨æ€è‡ªé€‚åº”é˜ˆå€¼ |
| **ğŸŸ¢ æ— å¤åˆäº‹ä»¶æ£€æµ‹** | å•ä¸€æŒ‡æ ‡è§¦å‘ | ä½ | å¤šæŒ‡æ ‡ç»„åˆæ£€æµ‹ |

---

## å››ã€å…³é”®ä¼˜åŒ–æœºä¼šåˆ†æ

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼šAI-äº‹ä»¶è”åŠ¨

#### é—®é¢˜æè¿°

```
å½“å‰çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIå†³ç­–ç³»ç»Ÿ  â”‚  âŒ    â”‚ äº‹ä»¶ç›‘æ§ç³»ç»Ÿ â”‚
â”‚  (æ¯5åˆ†é’Ÿ)   â”‚  å­¤ç«‹  â”‚  (æ¯5ç§’)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾‹å¦‚ï¼š
â€¢ EventMonitor æ£€æµ‹åˆ° BTC å¿«é€Ÿä¸‹è·Œ 3%
â€¢ ä½† AIDecisionScheduler ä¸‹ä¸€æ¬¡è¿è¡Œè¿˜è¦ç­‰ 4 åˆ†é’Ÿ
â€¢ AI å†³ç­–æ—¶å®Œå…¨ä¸çŸ¥é“åˆšæ‰å‘ç”Ÿäº†å‰§çƒˆæ³¢åŠ¨
```

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ 1: AI å†³ç­–æ—¶æŸ¥è¯¢æœ€è¿‘äº‹ä»¶**

```python
class AIDecisionScheduler:
    def make_ai_decision(self, symbol, analysis):
        # ğŸ†• è·å–æœ€è¿‘ 5 åˆ†é’Ÿçš„äº‹ä»¶
        recent_events = self.db.get_recent_events(
            symbol=symbol,
            minutes=5,
            min_severity='MEDIUM'
        )

        # æ„å»ºäº‹ä»¶ä¸Šä¸‹æ–‡
        event_context = {
            'has_critical_events': any(e.severity == 'CRITICAL' for e in recent_events),
            'flash_crash_detected': any(e.event_type == 'FLASH_CRASH' for e in recent_events),
            'volatility_spike': any(e.event_type == 'VOLATILITY_SPIKE' for e in recent_events),
            'events_summary': [
                f"{e.event_type}: {e.description}"
                for e in recent_events[:3]
            ]
        }

        # ğŸ†• ä¼ é€’ç»™ AI
        model_1, model_2, final = self.ai_engine.get_dual_model_decision(
            ...
            event_context=event_context  # æ–°å¢å‚æ•°
        )
```

**æ–¹æ¡ˆ 2: äº‹ä»¶è§¦å‘ç´§æ€¥ AI åˆ†æ**

```python
class EventMonitor:
    def _handle_event(self, event: MarketEvent):
        # å¦‚æœæ˜¯é«˜ä¸¥é‡æ€§äº‹ä»¶ï¼Œç«‹å³è§¦å‘ AI åˆ†æ
        if event.severity in [EventSeverity.HIGH, EventSeverity.CRITICAL]:
            if self.ai_scheduler_callback:
                self.ai_scheduler_callback.trigger_emergency_analysis(
                    symbol=event.symbol,
                    reason=f"Emergency: {event.description}"
                )
```

#### é¢„æœŸæ”¶ç›Š

- âœ… AI å†³ç­–è´¨é‡æå‡ 20-30%ï¼ˆåŸºäºäº‹ä»¶æ„ŸçŸ¥ï¼‰
- âœ… å¿«é€Ÿå“åº”å¸‚åœºå¼‚å¸¸ï¼ˆä¸å¿…ç­‰ 5 åˆ†é’Ÿï¼‰
- âœ… æ›´æ™ºèƒ½çš„é£é™©ç®¡ç†ï¼ˆæ£€æµ‹åˆ°æ¸…ç®—é£é™©ç«‹å³æ­¢æŸï¼‰

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼šæ•°æ®ç¼“å­˜å…±äº«

#### é—®é¢˜æè¿°

```
å½“å‰æ¯ 5 ç§’ï¼š
EventMonitor._fetch_market_data('BTC/USDT')
  â†’ get_ticker()
  â†’ get_ohlcv('1m', 60)
  â†’ get_ohlcv('5m', 60)
  â†’ get_ohlcv('15m', 60)
  â†’ get_ohlcv('1h', 30)

åŒæ—¶æ¯ 5 åˆ†é’Ÿï¼š
AIDecisionScheduler.analyze_symbol('BTC/USDT')
  â†’ get_ticker()
  â†’ get_ohlcv('1h', 200)  # é‡å¤è·å–ï¼
```

#### è§£å†³æ–¹æ¡ˆ

```python
class MarketDataCache:
    def __init__(self, ttl_seconds=30):
        self.cache = {}
        self.ttl = ttl_seconds

    def get_or_fetch(self, key, fetch_func):
        if key in self.cache:
            data, timestamp = self.cache[key]
            if time.time() - timestamp < self.ttl:
                return data

        # ç¼“å­˜è¿‡æœŸï¼Œé‡æ–°è·å–
        data = fetch_func()
        self.cache[key] = (data, time.time())
        return data

class MarketDataCollector:
    def __init__(self):
        self.cache = MarketDataCache(ttl_seconds=30)

    def get_ohlcv(self, symbol, timeframe, limit):
        key = f"{symbol}:{timeframe}:{limit}"
        return self.cache.get_or_fetch(
            key,
            lambda: self._fetch_from_exchange(symbol, timeframe, limit)
        )
```

#### é¢„æœŸæ”¶ç›Š

- âœ… API è¯·æ±‚é‡å‡å°‘ 40-60%
- âœ… å“åº”é€Ÿåº¦æå‡ 50-100ms
- âœ… é¿å…äº¤æ˜“æ‰€ API é€Ÿç‡é™åˆ¶

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼šå¢åŠ æŒ‡æ ‡å‹äº‹ä»¶æ£€æµ‹

#### å½“å‰èƒ½åŠ›

- âœ… å¿«é€Ÿä¸‹è·Œ/ä¸Šæ¶¨ (ä»·æ ¼å˜åŒ–)
- âœ… æˆäº¤é‡æ¿€å¢/æ¯ç«­ (æˆäº¤é‡)
- âœ… æ³¢åŠ¨ç‡æ¿€å¢ (ATR)
- âœ… æ¸…ç®—é£é™© (æŒä»“ç›¸å…³)

#### æ½œåœ¨æ–°äº‹ä»¶ç±»å‹

**1. RSI æç«¯äº‹ä»¶**

```python
def detect_extreme_rsi(self, symbol: str, klines: List[dict]) -> Optional[MarketEvent]:
    """æ£€æµ‹ RSI æç«¯è¶…ä¹°/è¶…å– (RSI > 85 æˆ– < 15)"""
    df = self._klines_to_dataframe(klines)
    df = self.technical_analyzer.calculate_all_indicators(df)

    rsi = df['RSI'].iloc[-1]

    if rsi > 85:
        return MarketEvent(
            event_type=EventType.EXTREME_OVERBOUGHT,
            severity=EventSeverity.HIGH if rsi > 90 else EventSeverity.MEDIUM,
            description=f"{symbol} RSI æåº¦è¶…ä¹° ({rsi:.1f})",
            suggested_action="è€ƒè™‘å‡ä»“æˆ–æ­¢ç›ˆ"
        )
    elif rsi < 15:
        return MarketEvent(
            event_type=EventType.EXTREME_OVERSOLD,
            severity=EventSeverity.HIGH if rsi < 10 else EventSeverity.MEDIUM,
            description=f"{symbol} RSI æåº¦è¶…å– ({rsi:.1f})",
            suggested_action="è€ƒè™‘æŠ„åº•æˆ–è§‚æœ›"
        )
```

**2. MACD äº¤å‰ä¿¡å·**

```python
def detect_macd_crossover(self, symbol: str, klines: List[dict]) -> Optional[MarketEvent]:
    """æ£€æµ‹ MACD é‡‘å‰/æ­»å‰"""
    df = self._klines_to_dataframe(klines)
    df = self.technical_analyzer.calculate_all_indicators(df)

    if len(df) < 2:
        return None

    macd_curr = df['MACD_12_26_9'].iloc[-1]
    signal_curr = df['MACDs_12_26_9'].iloc[-1]
    macd_prev = df['MACD_12_26_9'].iloc[-2]
    signal_prev = df['MACDs_12_26_9'].iloc[-2]

    # é‡‘å‰: MACD ä»ä¸‹æ–¹ç©¿è¿‡ä¿¡å·çº¿
    if macd_prev < signal_prev and macd_curr > signal_curr:
        return MarketEvent(
            event_type=EventType.MACD_GOLDEN_CROSS,
            severity=EventSeverity.MEDIUM,
            description=f"{symbol} MACD é‡‘å‰ï¼ˆçœ‹æ¶¨ä¿¡å·ï¼‰",
            suggested_action="è€ƒè™‘åšå¤š"
        )

    # æ­»å‰: MACD ä»ä¸Šæ–¹ç©¿è¿‡ä¿¡å·çº¿
    elif macd_prev > signal_prev and macd_curr < signal_curr:
        return MarketEvent(
            event_type=EventType.MACD_DEATH_CROSS,
            severity=EventSeverity.MEDIUM,
            description=f"{symbol} MACD æ­»å‰ï¼ˆçœ‹è·Œä¿¡å·ï¼‰",
            suggested_action="è€ƒè™‘åšç©ºæˆ–æ­¢æŸ"
        )
```

**3. å¸ƒæ—å¸¦çªç ´**

```python
def detect_bollinger_breakout(self, symbol: str, klines: List[dict]) -> Optional[MarketEvent]:
    """æ£€æµ‹ä»·æ ¼çªç ´å¸ƒæ—å¸¦"""
    df = self._klines_to_dataframe(klines)
    df = self.technical_analyzer.calculate_all_indicators(df)

    current_price = df['close'].iloc[-1]
    bb_upper = df['BBU_20_2.0'].iloc[-1]
    bb_lower = df['BBL_20_2.0'].iloc[-1]

    if current_price > bb_upper:
        return MarketEvent(
            event_type=EventType.BB_UPPER_BREAKOUT,
            severity=EventSeverity.MEDIUM,
            description=f"{symbol} çªç ´å¸ƒæ—å¸¦ä¸Šè½¨ï¼ˆå¯èƒ½è¶…ä¹°ï¼‰",
            suggested_action="è­¦æƒ•å›è°ƒé£é™©"
        )
    elif current_price < bb_lower:
        return MarketEvent(
            event_type=EventType.BB_LOWER_BREAKOUT,
            severity=EventSeverity.MEDIUM,
            description=f"{symbol} è·Œç ´å¸ƒæ—å¸¦ä¸‹è½¨ï¼ˆå¯èƒ½è¶…å–ï¼‰",
            suggested_action="å…³æ³¨åå¼¹æœºä¼š"
        )
```

#### é¢„æœŸæ”¶ç›Š

- âœ… äº‹ä»¶æ£€æµ‹èƒ½åŠ›æ‰©å±• 4-6 ç§æ–°ç±»å‹
- âœ… æ›´å…¨é¢çš„å¸‚åœºå¼‚å¸¸æ•æ‰
- âœ… æ›´ç²¾å‡†çš„äº¤æ˜“ä¿¡å·

---

## äº”ã€å»ºè®®çš„ä¼˜åŒ–è·¯å¾„

### Phase 1: ç«‹å³å®æ–½ï¼ˆ1-2å¤©ï¼‰ğŸš€

**1. AI-äº‹ä»¶è”åŠ¨åŸºç¡€ç‰ˆ**
- AI å†³ç­–æ—¶æŸ¥è¯¢æœ€è¿‘ 5 åˆ†é’Ÿçš„äº‹ä»¶
- å°†äº‹ä»¶ä¸Šä¸‹æ–‡ä¼ é€’ç»™ AI prompt
- æµ‹è¯• AI å¯¹äº‹ä»¶çš„å“åº”

**2. å¢åŠ  2-3 ä¸ªæŒ‡æ ‡å‹äº‹ä»¶**
- RSI æç«¯äº‹ä»¶ï¼ˆæœ€ç®€å•ï¼‰
- MACD äº¤å‰ä¿¡å·ï¼ˆä¸­ç­‰éš¾åº¦ï¼‰
- å¸ƒæ—å¸¦çªç ´ï¼ˆä¸­ç­‰éš¾åº¦ï¼‰

### Phase 2: çŸ­æœŸä¼˜åŒ–ï¼ˆ3-5å¤©ï¼‰ğŸ“Š

**3. æ•°æ®ç¼“å­˜å±‚**
- å®ç° `MarketDataCache`
- é›†æˆåˆ° `MarketDataCollector`
- æ€§èƒ½æµ‹è¯•å’Œè°ƒä¼˜

**4. äº‹ä»¶è§¦å‘ç´§æ€¥åˆ†æ**
- é«˜ä¸¥é‡æ€§äº‹ä»¶è§¦å‘å³æ—¶ AI åˆ†æ
- é¿å…ç­‰å¾… 5 åˆ†é’Ÿå‘¨æœŸ

### Phase 3: ä¸­æœŸå¢å¼ºï¼ˆ1-2å‘¨ï¼‰ğŸ”§

**5. å¤åˆäº‹ä»¶æ£€æµ‹**
- ä»·æ ¼çªç ´ + æˆäº¤é‡æ¿€å¢ = æœ‰æ•ˆçªç ´
- RSI è¶…ä¹° + MACD æ­»å‰ = å¼ºåè½¬ä¿¡å·

**6. åŠ¨æ€é˜ˆå€¼è°ƒæ•´**
- åŸºäºå†å²æ•°æ®è‡ªé€‚åº”é˜ˆå€¼
- ä¸åŒæ³¢åŠ¨ç‡ç¯å¢ƒä½¿ç”¨ä¸åŒå‚æ•°

---

## é™„å½•

### A. é‡æ„å†å²

**é‡æ„æ—¥æœŸ**: 2024-11-07
**é‡æ„å†…å®¹**: EventDetector ç»Ÿä¸€ä½¿ç”¨ TechnicalAnalyzer
**ä»£ç å˜æ›´**: 1 file changed, 53 insertions(+), 44 deletions(-)
**å…³é”®æ”¹è¿›**:
- âœ… å¯¼å…¥å¹¶åˆå§‹åŒ– `TechnicalAnalyzer`
- âœ… æ–°å¢ `_klines_to_dataframe()` è¾…åŠ©æ–¹æ³•
- âœ… é‡æ„ `detect_volatility_spike()` ä½¿ç”¨ç»Ÿä¸€ ATR è®¡ç®—
- âœ… åˆ é™¤æ‰‹åŠ¨å®ç°çš„ `_calculate_atr()` æ–¹æ³•

### B. æ–‡ä»¶ä½ç½®ç´¢å¼•

```
backend/
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ decision_engine.py         # åŒæ¨¡å‹æŠ•ç¥¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ decision_scheduler.py      # AI å†³ç­–è°ƒåº¦å™¨
â”‚   â””â”€â”€ prompt_templates.py        # AI prompt æ¨¡æ¿
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ technical_indicators.py    # ğŸ”¹ æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼ˆç»Ÿä¸€æºï¼‰
â”‚   â””â”€â”€ fundamental_analyzer.py    # åŸºæœ¬é¢åˆ†æ
â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ event_monitor.py           # äº‹ä»¶ç›‘æ§ä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ event_detector.py          # ğŸ”¹ äº‹ä»¶æ£€æµ‹å™¨ï¼ˆé‡æ„åï¼‰
â”‚   â”œâ”€â”€ event_types.py             # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ event_config.py            # äº‹ä»¶æ£€æµ‹é…ç½®
â”œâ”€â”€ core/
â”‚   â””â”€â”€ trading_engine.py          # äº¤æ˜“å¼•æ“
â”œâ”€â”€ data/
â”‚   â””â”€â”€ market_data_collector.py   # å¸‚åœºæ•°æ®æ”¶é›†ï¼ˆCCXTï¼‰
â””â”€â”€ database/
    â”œâ”€â”€ models.py                  # æ•°æ®åº“æ¨¡å‹
    â””â”€â”€ db_manager.py              # æ•°æ®åº“ç®¡ç†å™¨
```

### C. ç›¸å…³æ–‡æ¡£

- [ARCHITECTURE.md](./ARCHITECTURE.md) - åŸå§‹æ¶æ„æ–‡æ¡£ï¼ˆV1ï¼‰
- [DECISION_MECHANISM.md](./DECISION_MECHANISM.md) - AI å†³ç­–æœºåˆ¶è¯¦è§£
- [PAPER_TRADING_FEATURES.md](./PAPER_TRADING_FEATURES.md) - æ¨¡æ‹Ÿäº¤æ˜“åŠŸèƒ½

---

**æ–‡æ¡£ç»“æŸ**
